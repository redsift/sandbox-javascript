#!/bin/bash
set -eu

nv="${NODE_VERSION:-12.14.0}"

echo "Installing node-capnp for node:${nv}..."

rm -rf ./node-capnp
if [[ $nv == 8* ]]; then
    git clone https://github.com/capnproto/node-capnp.git
elif [[ $nv == 12* ]]; then
    git clone --single-branch --branch node12 https://github.com/redsift/node-capnp.git
else
    git clone --single-branch --branch patched https://github.com/redsift/node-capnp.git
fi

npm i --prefix ./node-capnp
